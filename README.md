# ONNX Parser

–ü–∞—Ä—Å–µ—Ä –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ **ONNX** –Ω–∞ —è–∑—ã–∫–µ **C++**.

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ONNX –º–æ–¥–µ–ª–∏ –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥—Ä–∞—Ñ, –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é GraphViz.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| **–ü–∞—Ä—Å–∏–Ω–≥ ONNX** | –ß—Ç–µ–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (protobuf/varint) |
| **–ì—Ä–∞—Ñ –Ω–∞ C++** | –ö–ª–∞—Å—Å—ã `Graph`, `Node`, `Tensor` |
| **8+ –æ–ø–µ—Ä–∞—Ü–∏–π** | Conv, Relu, Gemm, MatMul, Add, Mul, Reshape, Concat |
| **–ê—Ç—Ä–∏–±—É—Ç—ã** | strides, dilations, group, alpha, beta, transB, allowzero, auto_pad |
| **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è** | –≠–∫—Å–ø–æ—Ä—Ç –≤ GraphViz DOT —Å —Ü–≤–µ—Ç–∞–º–∏ –∏ —Ñ–æ—Ä–º–∞–º–∏ |
| **–¢–µ—Å—Ç—ã** | 3 —Ç–µ—Å—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ + CMake testing |

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ó–∞—á–µ–º |
|-----------|--------|-------|
| C++ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä | C++17 (GCC 7+, Clang 5+, AppleClang 15+) | –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ |
| CMake | 3.10+ | –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏ |
| GraphViz | –õ—é–±–∞—è  | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ |

## C–±–æ—Ä–∫–∞

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É build
mkdir -p build && cd build

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ CMake
cmake ..

# 3. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
make

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
ctest --verbose
```
## –ó–∞–ø—É—Å–∫

```bash
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
./parser path/to/model.onnx

# –ü—Ä–∏–º–µ—Ä—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
./parser ../tests/simple_matmul.onnx
./parser ../tests/complex_net.onnx
./parser ../tests/custom_net.onnx
```

### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞
```bash
=== Loading: tests/complex_net.onnx ===

=== Parsed Graph Info ===
IR version: 10
Producer: pytorch v2.10.0
Graph name: main_graph

=== Nodes ===
Op: Conv
  Inputs: input conv1.weight conv1.bias
  Outputs: conv2d
  [group: 1]
  [strides: 1 1]
  [dilations: 1 1]

Op: Relu
  Inputs: conv2d
  Outputs: relu

...

‚úÖ Parsing completed successfully!
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∏—Ö –∞—Ç—Ä–∏–±—É—Ç—ã

| –û–ø–µ—Ä–∞—Ü–∏—è | –ê—Ç—Ä–∏–±—É—Ç—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| **Conv** | `strides`, `dilations`, `group`, `auto_pad` | –°–≤–µ—Ä—Ç–∫–∞ |
| **Relu** | ‚Äî | –§—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ |
| **Gemm** | `alpha`, `beta`, `transA`, `transB` | –ü–æ–ª–Ω–æ—Å–≤—è–∑–Ω—ã–π —Å–ª–æ–π |
| **MatMul** | ‚Äî | –£–º–Ω–æ–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü |
| **Add** | ‚Äî | –ü–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ |
| **Mul** | ‚Äî | –ü–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ |
| **Reshape** | `allowzero` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ç–µ–Ω–∑–æ—Ä–∞ |
| **Concat** | `axis` | –ö–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Ç–µ–Ω–∑–æ—Ä–æ–≤ |
| **Shape** | ‚Äî | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ç–µ–Ω–∑–æ—Ä–∞ |


## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
.
‚îú‚îÄ‚îÄ CMakeLists.txt          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .gitignore              # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îú‚îÄ‚îÄ bin_reader.h        # –ß—Ç–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ –∏ varint
‚îÇ   ‚îî‚îÄ‚îÄ parser.h            # –ö–ª–∞—Å—Å—ã Graph, Node, Tensor
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ parser.cpp          # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ simple_matmul.onnx  # –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤—ã–π MatMul
    ‚îú‚îÄ‚îÄ complex_net.onnx    # –¢–µ—Å—Ç 2: CNN + FC —Å–ª–æ–∏
    ‚îî‚îÄ‚îÄ custom_net.onnx     # –¢–µ—Å—Ç 3: –†–µ–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å
```

## –¢–µ—Å—Ç—ã
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç 3 —Ç–µ—Å—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:
| –ú–æ–¥–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –û–ø–µ—Ä–∞—Ü–∏–∏ |
|--------|----------|----------|
| `simple_matmul.onnx` | –ü—Ä–æ—Å—Ç–æ–µ —É–º–Ω–æ–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü | `MatMul` |
| `complex_net.onnx` | CNN + Fully Connected | `Conv`, `Relu`, `Reshape`, `Gemm` |
| `custom_net.onnx` | –†–µ–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å | `Conv`, `Relu`, `Add`, `Mul`, `Gemm` |

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
cd build
ctest --verbose
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
### –ö–ª–∞—Å—Å—ã
| –ö–ª–∞—Å—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| **BinaryReader** | –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ —á—Ç–µ–Ω–∏–µ –±–∞–π—Ç–æ–≤ –∏ varint |
| **Tensor** | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–Ω–∑–æ—Ä–∞ (–∏–º—è, —Ä–∞–∑–º–µ—Ä—ã, —Ç–∏–ø, –¥–∞–Ω–Ω—ã–µ) |
| **Node** | –û–ø–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ (—Ç–∏–ø, –≤—Ö–æ–¥—ã, –≤—ã—Ö–æ–¥—ã, –∞—Ç—Ä–∏–±—É—Ç—ã) |
| **Graph** | –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ (—É–∑–ª—ã, —Ç–µ–Ω–∑–æ—Ä—ã, –≤—Ö–æ–¥—ã, –≤—ã—Ö–æ–¥—ã) |
| **ONNXParser** | –ì–ª–∞–≤–Ω—ã–π –ø–∞—Ä—Å–µ—Ä (—á—Ç–µ–Ω–∏–µ ONNX ‚Üí Graph) |

### –§–æ—Ä–º–∞—Ç ONNX
ONNX –∏—Å–ø–æ–ª—å–∑—É–µ—Ç protobuf —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é:
Varint ‚Äî –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–ª–∏–Ω—ã
Wire types ‚Äî —Ç–∏–ø—ã –ø–æ–ª–µ–π (0=varint, 2=length-delimited, 5=fixed32)
Field numbers ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª–µ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞

–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞ –Ω–∞ –º–æ–¥–µ–ª–∏ `custom_net.onnx`:

![–ì—Ä–∞—Ñ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏](images/graph.png)

## üë§ –ê–≤—Ç–æ—Ä

**–ì–∞–ª–∏–Ω–∞ –ë—É—Å–∞—Ä–æ–≤–∞**

–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö –∫—É—Ä—Å–∞ –ø–æ —Ç–µ–Ω–∑–æ—Ä–Ω—ã–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞–º.
